"use strict";angular.module("vnext.cart",["vnext.cart.templates","ui.router","vnext.components","vNext"]).config(["$stateProvider","$translateProvider",function(t,e){e.useLocalStorage(),t.state("cart",{url:"/cart",parent:"root",templateUrl:"standard/vn-standard-cart.tpl.html",controller:"vnCartCtrl"})}]).run(["$rootScope","vnCartConfig","$state",function(t,e,n){var a=e.getCartType();"slide-out"===a&&($("body").append("<div data-vn-slide-out-cart></div>"),t.$on("$stateChangeStart",function(){t.$emit("CartEvents.SlideOut.Close")})),t.$on("CartEvents.GoToCart",function(){"slide-out"===a?t.$emit("CartEvents.SlideOut.Open"):n.go("cart")}),t.$on("CartEvents.ExitCart",function(){"slide-out"===a&&t.$emit("CartEvents.SlideOut.Close")})}]),angular.module("vnext.cart").provider("vnCartConfig",[function(){function t(){this.CartConfig=function(){return this},this.getCartType=function(){return e}}var e="slide-out";this.setCartType=function(t){e=t},this.getCartType=function(){return e},this.$get=function(){return new t}}]),angular.module("vnext.cart").controller("vnCartCtrl",["$rootScope","$scope","$timeout","$filter","$window","$state","vNextCart","lodash","vnAppMessageService","$translate",function(t,e,n,a,r,o,i,c,u,s){t.$on("CartMessages.ItemRemoved",function(t,e){s("cart.CART_ITEM_REMOVED",e).then(function(t){u.addMessage({text:t})})}),t.$on("CartMessages.ItemNameChanged",function(t,e){s("cart.CART_ITEM_NAME_CHANGED",e).then(function(t){u.addMessage({text:t})})}),t.$on("CartMessages.ItemPriceIncreased",function(t,e){s("cart.CART_ITEM_PRICE_INCREASED",e).then(function(t){u.addMessage({text:t})})}),t.$on("CartMessages.ItemPriceDecreased",function(t,e){s("cart.CART_ITEM_PRICE_DECREASED",e).then(function(t){u.addMessage({text:t})})}),t.$on("CartEvents.SlideOut.Close",function(){e.state="cart"}),t.$on("CartEvents.SlideOut.Open",function(){e.state="cart"}),e.cart={items:[]},e.cartEmpty=!0,e.loading=!1,e.state="cart",e.checkout=function(){e.state="login"},e.closeLogin=function(){e.state="cart"},e.updateCart=function(t,n,a){e.loading=t?!0:!1,i.updateItemInCart(n).then(function(){e.getCart(),void 0!==a&&"function"==typeof a&&a()})},t.getCart=function(){i.getOrCreateCart().then(function(t){e.cart=t,e.cartEmpty=i.getCartItemsCount()>0?!1:!0})},e.getCartItemsCount=function(){return i.getCartItemsCount()},e.deleteItem=function(t){e.loading=!0,i.removeItemFromCart(t).then(function(){e.loading=!1,e.cartEmpty=i.getCartItemsCount()>0?!1:!0})},e.decreaseQtyByOne=function(t){e.changeQty(t,t.quantity-1,300)},e.increaseQtyByOne=function(t){e.changeQty(t,t.quantity+1,300)},e.changeQty=function(t,a,r){t.quantity=""===t.quantity?1:a,n.cancel(e.debounceUpdateCart),void 0===r?e.updateCart(!1,t):e.debounceUpdateCart=n(function(){e.updateCart(!1,t)},r)},e.visualCue=!1,t.isCartOpen=!1,e.device=t.device,e.resetGiftOptions=function(){return e.cart.misc.isGift?(e.visualCue=!0,n(function(){e.visualCue=!1},3e3),void 0):(angular.forEach(e.cart.items,function(t){t.isGiftWrapAvailable&&t.giftWrap.selected&&(t.giftWrap.selected=!1)}),e.updateCart(!0),void 0)},e.deleteCoupon=function(t){e.cart.discounts=a("filter")(e.cart.discounts,function(e){return e.id!==t}),e.couponsEmpty=e.cart.discounts.length>0?!1:!0,e.updateCart(!0)},t.$on("cart.startLoading",function(){e.loading=!0}),t.$on("cart.stopLoading",function(){e.loading=!1}),t.$on("CartEvents.CartUpdated",function(){e.getCart(),e.loading=!1}),e.getCart()}]),angular.module("vnext.cart").directive("vnCartLink",["$rootScope",function(t){return{restrict:"A",link:function(e,n){n.bind("click",function(){t.$emit("CartEvents.GoToCart")})}}}]),angular.module("vnext.cart").directive("vnSlideOutCart",["$rootScope",function(t){return{restrict:"A",templateUrl:"slide-out/vn-slide-out-cart.tpl.html",controller:"vnCartCtrl",link:function(e){t.$on("CartEvents.SlideOut.Open",function(){e.openCart()}),t.$on("CartEvents.SlideOut.Close",function(){e.closeCart()}),t.$on("CartEvents.SlideOut.Toggle",function(){e.toggleCart()}),e.openCart=function(){angular.element("body").addClass("cart-active"),t.isCartOpen=!0,t.getCart()},e.closeCart=function(){angular.element("body").removeClass("cart-active"),t.isCartOpen=!1},e.toggleCart=function(){e.isCartOpen?e.closeCart():e.openCart()}}}}]);